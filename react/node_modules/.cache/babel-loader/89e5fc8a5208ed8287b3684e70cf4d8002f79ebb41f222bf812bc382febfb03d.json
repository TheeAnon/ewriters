{"ast":null,"code":"import _regeneratorRuntime from\"D:/Japhe/Code/ewriters-mega/e/ewriters/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"D:/Japhe/Code/ewriters-mega/e/ewriters/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import{useAuthStore}from\"../store/auth\";import axios from\"./axios\";import jwt_decode from\"jwt-decode\";import Cookies from\"js-cookie\";export var login=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(email,password){var _yield$axios$post,data,status,_error$response$data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return axios.post(\"token/\",{email:email,password:password});case 3:_yield$axios$post=_context.sent;data=_yield$axios$post.data;status=_yield$axios$post.status;if(status===200){setAuthUser(data.access,data.refresh);}return _context.abrupt(\"return\",{data:data,error:null});case 10:_context.prev=10;_context.t0=_context[\"catch\"](0);return _context.abrupt(\"return\",{data:null,error:((_error$response$data=_context.t0.response.data)===null||_error$response$data===void 0?void 0:_error$response$data.detail)||\"Something went wrong\"});case 13:case\"end\":return _context.stop();}},_callee,null,[[0,10]]);}));return function login(_x,_x2){return _ref.apply(this,arguments);};}();export var register=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(first_name,last_name,email,password){var _yield$axios$post2,data;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return axios.post(\"register/\",{first_name:first_name,last_name:last_name,email:email,password:password});case 3:_yield$axios$post2=_context2.sent;data=_yield$axios$post2.data;_context2.next=7;return login(email,password);case 7:return _context2.abrupt(\"return\",{data:data,error:null});case 10:_context2.prev=10;_context2.t0=_context2[\"catch\"](0);return _context2.abrupt(\"return\",{data:null,error:_context2.t0.response.data||\"Something went wrong\"});case 13:case\"end\":return _context2.stop();}},_callee2,null,[[0,10]]);}));return function register(_x3,_x4,_x5,_x6){return _ref2.apply(this,arguments);};}();export var logout=function logout(){Cookies.remove(\"access_token\");Cookies.remove(\"refresh_token\");useAuthStore.getState().setUser(null);};export var setUser=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(){var accessToken,refreshToken,response;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:// ON PAGE LOAD\naccessToken=Cookies.get(\"access_token\");refreshToken=Cookies.get(\"refresh_token\");if(!(!accessToken||!refreshToken)){_context3.next=4;break;}return _context3.abrupt(\"return\");case 4:if(!isAccessTokenExpired(accessToken)){_context3.next=11;break;}_context3.next=7;return getRefreshToken(refreshToken);case 7:response=_context3.sent;setAuthUser(response.access,response.refresh);_context3.next=12;break;case 11:setAuthUser(accessToken,refreshToken);case 12:case\"end\":return _context3.stop();}},_callee3);}));return function setUser(){return _ref3.apply(this,arguments);};}();export var setAuthUser=function setAuthUser(access_token,refresh_token){var _jwt_decode;Cookies.set(\"access_token\",access_token,{expires:1,secure:true});Cookies.set(\"refresh_token\",refresh_token,{expires:7,secure:true});var user=(_jwt_decode=jwt_decode(access_token))!==null&&_jwt_decode!==void 0?_jwt_decode:null;if(user){useAuthStore.getState().setUser(user);}useAuthStore.getState().setLoading(false);};export var getRefreshToken=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(){var refresh_token,response;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1)switch(_context4.prev=_context4.next){case 0:refresh_token=Cookies.get(\"refresh_token\");_context4.next=3;return axios.post(\"token/refresh/\",{refresh:refresh_token});case 3:response=_context4.sent;return _context4.abrupt(\"return\",response.data);case 5:case\"end\":return _context4.stop();}},_callee4);}));return function getRefreshToken(){return _ref4.apply(this,arguments);};}();export var isAccessTokenExpired=function isAccessTokenExpired(accessToken){try{var decodedToken=jwt_decode(accessToken);return decodedToken.exp<Date.now()/1000;}catch(err){return true;// Token is invalid or expired\n}};","map":{"version":3,"names":["useAuthStore","axios","jwt_decode","Cookies","login","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","email","password","_yield$axios$post","data","status","_error$response$data","wrap","_callee$","_context","prev","next","post","sent","setAuthUser","access","refresh","abrupt","error","t0","response","detail","stop","_x","_x2","apply","arguments","register","_ref2","_callee2","first_name","last_name","_yield$axios$post2","_callee2$","_context2","_x3","_x4","_x5","_x6","logout","remove","getState","setUser","_ref3","_callee3","accessToken","refreshToken","_callee3$","_context3","get","isAccessTokenExpired","getRefreshToken","access_token","refresh_token","_jwt_decode","set","expires","secure","user","setLoading","_ref4","_callee4","_callee4$","_context4","decodedToken","exp","Date","now","err"],"sources":["D:/Japhe/Code/ewriters-mega/e/ewriters/src/utils/auth.js"],"sourcesContent":["import { useAuthStore } from \"../store/auth\";\r\nimport axios from \"./axios\";\r\nimport jwt_decode from \"jwt-decode\";\r\nimport Cookies from \"js-cookie\";\r\n\r\nexport const login = async (email, password) => {\r\n  try {\r\n    const { data, status } = await axios.post(\"token/\", {\r\n      email,\r\n      password,\r\n    });\r\n    if (status === 200) {\r\n      setAuthUser(data.access, data.refresh);\r\n    }\r\n    return { data, error: null };\r\n  } catch (error) {\r\n    return {\r\n      data: null,\r\n      error: error.response.data?.detail || \"Something went wrong\",\r\n    };\r\n  }\r\n};\r\n\r\nexport const register = async (first_name, last_name, email, password) => {\r\n  try {\r\n    const { data } = await axios.post(\"register/\", {\r\n      first_name,\r\n      last_name,\r\n      email,\r\n      password,\r\n    });\r\n    await login(email, password);\r\n    return { data, error: null };\r\n  } catch (error) {\r\n    return {\r\n      data: null,\r\n      error: error.response.data || \"Something went wrong\",\r\n    };\r\n  }\r\n};\r\n\r\nexport const logout = () => {\r\n  Cookies.remove(\"access_token\");\r\n  Cookies.remove(\"refresh_token\");\r\n  useAuthStore.getState().setUser(null);\r\n};\r\n\r\nexport const setUser = async () => {\r\n  // ON PAGE LOAD\r\n  const accessToken = Cookies.get(\"access_token\");\r\n  const refreshToken = Cookies.get(\"refresh_token\");\r\n  if (!accessToken || !refreshToken) {\r\n    return;\r\n  }\r\n  if (isAccessTokenExpired(accessToken)) {\r\n    const response = await getRefreshToken(refreshToken);\r\n    setAuthUser(response.access, response.refresh);\r\n  } else {\r\n    setAuthUser(accessToken, refreshToken);\r\n  }\r\n};\r\n\r\nexport const setAuthUser = (access_token, refresh_token) => {\r\n  Cookies.set(\"access_token\", access_token, {\r\n    expires: 1,\r\n    secure: true,\r\n  });\r\n\r\n  Cookies.set(\"refresh_token\", refresh_token, {\r\n    expires: 7,\r\n    secure: true,\r\n  });\r\n\r\n  const user = jwt_decode(access_token) ?? null;\r\n\r\n  if (user) {\r\n    useAuthStore.getState().setUser(user);\r\n  }\r\n  useAuthStore.getState().setLoading(false);\r\n};\r\n\r\nexport const getRefreshToken = async () => {\r\n  const refresh_token = Cookies.get(\"refresh_token\");\r\n  const response = await axios.post(\"token/refresh/\", {\r\n    refresh: refresh_token,\r\n  });\r\n  return response.data;\r\n};\r\n\r\nexport const isAccessTokenExpired = (accessToken) => {\r\n  try {\r\n    const decodedToken = jwt_decode(accessToken);\r\n    return decodedToken.exp < Date.now() / 1000;\r\n  } catch (err) {\r\n    return true; // Token is invalid or expired\r\n  }\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}