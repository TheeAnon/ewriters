{"ast":null,"code":"import { useAuthStore } from \"../store/auth\";\nimport axios from \"./axios\";\nimport jwt_decode from \"jwt-decode\";\nimport Cookies from \"js-cookie\";\nexport const login = async (email, password) => {\n  try {\n    const {\n      data,\n      status\n    } = await axios.post(\"token/\", {\n      email,\n      password\n    });\n    if (status === 200) {\n      setAuthUser(data.access, data.refresh);\n    }\n    return {\n      data,\n      error: null\n    };\n  } catch (error) {\n    var _error$response$data;\n    return {\n      data: null,\n      error: ((_error$response$data = error.response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.detail) || \"Something went wrong\"\n    };\n  }\n};\nexport const register = async (first_name, last_name, email, password) => {\n  try {\n    const {\n      data\n    } = await axios.post(\"register/\", {\n      first_name,\n      last_name,\n      email,\n      password\n    });\n    await login(email, password);\n    return {\n      data,\n      error: null\n    };\n  } catch (error) {\n    return {\n      data: null,\n      error: error.response.data || \"Something went wrong\"\n    };\n  }\n};\nexport const logout = () => {\n  Cookies.remove(\"access_token\");\n  Cookies.remove(\"refresh_token\");\n  useAuthStore.getState().setUser(null);\n};\nexport const setUser = async () => {\n  // ON PAGE LOAD\n  const accessToken = Cookies.get(\"access_token\");\n  const refreshToken = Cookies.get(\"refresh_token\");\n  if (!accessToken || !refreshToken) {\n    return;\n  }\n  if (isAccessTokenExpired(accessToken)) {\n    const response = await getRefreshToken(refreshToken);\n    setAuthUser(response.access, response.refresh);\n  } else {\n    setAuthUser(accessToken, refreshToken);\n  }\n};\nexport const setAuthUser = (access_token, refresh_token) => {\n  var _jwt_decode;\n  Cookies.set(\"access_token\", access_token, {\n    expires: 1,\n    secure: true\n  });\n  Cookies.set(\"refresh_token\", refresh_token, {\n    expires: 7,\n    secure: true\n  });\n  const user = (_jwt_decode = jwt_decode(access_token)) !== null && _jwt_decode !== void 0 ? _jwt_decode : null;\n  if (user) {\n    useAuthStore.getState().setUser(user);\n  }\n  useAuthStore.getState().setLoading(false);\n};\nexport const getRefreshToken = async () => {\n  const refresh_token = Cookies.get(\"refresh_token\");\n  const response = await axios.post(\"token/refresh/\", {\n    refresh: refresh_token\n  });\n  return response.data;\n};\nexport const isAccessTokenExpired = accessToken => {\n  try {\n    const decodedToken = jwt_decode(accessToken);\n    return decodedToken.exp < Date.now() / 1000;\n  } catch (err) {\n    return true; // Token is invalid or expired\n  }\n};","map":{"version":3,"names":["useAuthStore","axios","jwt_decode","Cookies","login","email","password","data","status","post","setAuthUser","access","refresh","error","_error$response$data","response","detail","register","first_name","last_name","logout","remove","getState","setUser","accessToken","get","refreshToken","isAccessTokenExpired","getRefreshToken","access_token","refresh_token","_jwt_decode","set","expires","secure","user","setLoading","decodedToken","exp","Date","now","err"],"sources":["D:/Japhe/Code/ewriters-mega/e/ewriters/src/utils/auth.js"],"sourcesContent":["import { useAuthStore } from \"../store/auth\";\r\nimport axios from \"./axios\";\r\nimport jwt_decode from \"jwt-decode\";\r\nimport Cookies from \"js-cookie\";\r\n\r\nexport const login = async (email, password) => {\r\n  try {\r\n    const { data, status } = await axios.post(\"token/\", {\r\n      email,\r\n      password,\r\n    });\r\n    if (status === 200) {\r\n      setAuthUser(data.access, data.refresh);\r\n    }\r\n    return { data, error: null };\r\n  } catch (error) {\r\n    return {\r\n      data: null,\r\n      error: error.response.data?.detail || \"Something went wrong\",\r\n    };\r\n  }\r\n};\r\n\r\nexport const register = async (first_name, last_name, email, password) => {\r\n  try {\r\n    const { data } = await axios.post(\"register/\", {\r\n      first_name,\r\n      last_name,\r\n      email,\r\n      password,\r\n    });\r\n    await login(email, password);\r\n    return { data, error: null };\r\n  } catch (error) {\r\n    return {\r\n      data: null,\r\n      error: error.response.data || \"Something went wrong\",\r\n    };\r\n  }\r\n};\r\n\r\nexport const logout = () => {\r\n  Cookies.remove(\"access_token\");\r\n  Cookies.remove(\"refresh_token\");\r\n  useAuthStore.getState().setUser(null);\r\n};\r\n\r\nexport const setUser = async () => {\r\n  // ON PAGE LOAD\r\n  const accessToken = Cookies.get(\"access_token\");\r\n  const refreshToken = Cookies.get(\"refresh_token\");\r\n  if (!accessToken || !refreshToken) {\r\n    return;\r\n  }\r\n  if (isAccessTokenExpired(accessToken)) {\r\n    const response = await getRefreshToken(refreshToken);\r\n    setAuthUser(response.access, response.refresh);\r\n  } else {\r\n    setAuthUser(accessToken, refreshToken);\r\n  }\r\n};\r\n\r\nexport const setAuthUser = (access_token, refresh_token) => {\r\n  Cookies.set(\"access_token\", access_token, {\r\n    expires: 1,\r\n    secure: true,\r\n  });\r\n\r\n  Cookies.set(\"refresh_token\", refresh_token, {\r\n    expires: 7,\r\n    secure: true,\r\n  });\r\n\r\n  const user = jwt_decode(access_token) ?? null;\r\n\r\n  if (user) {\r\n    useAuthStore.getState().setUser(user);\r\n  }\r\n  useAuthStore.getState().setLoading(false);\r\n};\r\n\r\nexport const getRefreshToken = async () => {\r\n  const refresh_token = Cookies.get(\"refresh_token\");\r\n  const response = await axios.post(\"token/refresh/\", {\r\n    refresh: refresh_token,\r\n  });\r\n  return response.data;\r\n};\r\n\r\nexport const isAccessTokenExpired = (accessToken) => {\r\n  try {\r\n    const decodedToken = jwt_decode(accessToken);\r\n    return decodedToken.exp < Date.now() / 1000;\r\n  } catch (err) {\r\n    return true; // Token is invalid or expired\r\n  }\r\n};\r\n"],"mappings":"AAAA,SAASA,YAAY,QAAQ,eAAe;AAC5C,OAAOC,KAAK,MAAM,SAAS;AAC3B,OAAOC,UAAU,MAAM,YAAY;AACnC,OAAOC,OAAO,MAAM,WAAW;AAE/B,OAAO,MAAMC,KAAK,GAAG,MAAAA,CAAOC,KAAK,EAAEC,QAAQ,KAAK;EAC9C,IAAI;IACF,MAAM;MAAEC,IAAI;MAAEC;IAAO,CAAC,GAAG,MAAMP,KAAK,CAACQ,IAAI,CAAC,QAAQ,EAAE;MAClDJ,KAAK;MACLC;IACF,CAAC,CAAC;IACF,IAAIE,MAAM,KAAK,GAAG,EAAE;MAClBE,WAAW,CAACH,IAAI,CAACI,MAAM,EAAEJ,IAAI,CAACK,OAAO,CAAC;IACxC;IACA,OAAO;MAAEL,IAAI;MAAEM,KAAK,EAAE;IAAK,CAAC;EAC9B,CAAC,CAAC,OAAOA,KAAK,EAAE;IAAA,IAAAC,oBAAA;IACd,OAAO;MACLP,IAAI,EAAE,IAAI;MACVM,KAAK,EAAE,EAAAC,oBAAA,GAAAD,KAAK,CAACE,QAAQ,CAACR,IAAI,cAAAO,oBAAA,uBAAnBA,oBAAA,CAAqBE,MAAM,KAAI;IACxC,CAAC;EACH;AACF,CAAC;AAED,OAAO,MAAMC,QAAQ,GAAG,MAAAA,CAAOC,UAAU,EAAEC,SAAS,EAAEd,KAAK,EAAEC,QAAQ,KAAK;EACxE,IAAI;IACF,MAAM;MAAEC;IAAK,CAAC,GAAG,MAAMN,KAAK,CAACQ,IAAI,CAAC,WAAW,EAAE;MAC7CS,UAAU;MACVC,SAAS;MACTd,KAAK;MACLC;IACF,CAAC,CAAC;IACF,MAAMF,KAAK,CAACC,KAAK,EAAEC,QAAQ,CAAC;IAC5B,OAAO;MAAEC,IAAI;MAAEM,KAAK,EAAE;IAAK,CAAC;EAC9B,CAAC,CAAC,OAAOA,KAAK,EAAE;IACd,OAAO;MACLN,IAAI,EAAE,IAAI;MACVM,KAAK,EAAEA,KAAK,CAACE,QAAQ,CAACR,IAAI,IAAI;IAChC,CAAC;EACH;AACF,CAAC;AAED,OAAO,MAAMa,MAAM,GAAGA,CAAA,KAAM;EAC1BjB,OAAO,CAACkB,MAAM,CAAC,cAAc,CAAC;EAC9BlB,OAAO,CAACkB,MAAM,CAAC,eAAe,CAAC;EAC/BrB,YAAY,CAACsB,QAAQ,CAAC,CAAC,CAACC,OAAO,CAAC,IAAI,CAAC;AACvC,CAAC;AAED,OAAO,MAAMA,OAAO,GAAG,MAAAA,CAAA,KAAY;EACjC;EACA,MAAMC,WAAW,GAAGrB,OAAO,CAACsB,GAAG,CAAC,cAAc,CAAC;EAC/C,MAAMC,YAAY,GAAGvB,OAAO,CAACsB,GAAG,CAAC,eAAe,CAAC;EACjD,IAAI,CAACD,WAAW,IAAI,CAACE,YAAY,EAAE;IACjC;EACF;EACA,IAAIC,oBAAoB,CAACH,WAAW,CAAC,EAAE;IACrC,MAAMT,QAAQ,GAAG,MAAMa,eAAe,CAACF,YAAY,CAAC;IACpDhB,WAAW,CAACK,QAAQ,CAACJ,MAAM,EAAEI,QAAQ,CAACH,OAAO,CAAC;EAChD,CAAC,MAAM;IACLF,WAAW,CAACc,WAAW,EAAEE,YAAY,CAAC;EACxC;AACF,CAAC;AAED,OAAO,MAAMhB,WAAW,GAAGA,CAACmB,YAAY,EAAEC,aAAa,KAAK;EAAA,IAAAC,WAAA;EAC1D5B,OAAO,CAAC6B,GAAG,CAAC,cAAc,EAAEH,YAAY,EAAE;IACxCI,OAAO,EAAE,CAAC;IACVC,MAAM,EAAE;EACV,CAAC,CAAC;EAEF/B,OAAO,CAAC6B,GAAG,CAAC,eAAe,EAAEF,aAAa,EAAE;IAC1CG,OAAO,EAAE,CAAC;IACVC,MAAM,EAAE;EACV,CAAC,CAAC;EAEF,MAAMC,IAAI,IAAAJ,WAAA,GAAG7B,UAAU,CAAC2B,YAAY,CAAC,cAAAE,WAAA,cAAAA,WAAA,GAAI,IAAI;EAE7C,IAAII,IAAI,EAAE;IACRnC,YAAY,CAACsB,QAAQ,CAAC,CAAC,CAACC,OAAO,CAACY,IAAI,CAAC;EACvC;EACAnC,YAAY,CAACsB,QAAQ,CAAC,CAAC,CAACc,UAAU,CAAC,KAAK,CAAC;AAC3C,CAAC;AAED,OAAO,MAAMR,eAAe,GAAG,MAAAA,CAAA,KAAY;EACzC,MAAME,aAAa,GAAG3B,OAAO,CAACsB,GAAG,CAAC,eAAe,CAAC;EAClD,MAAMV,QAAQ,GAAG,MAAMd,KAAK,CAACQ,IAAI,CAAC,gBAAgB,EAAE;IAClDG,OAAO,EAAEkB;EACX,CAAC,CAAC;EACF,OAAOf,QAAQ,CAACR,IAAI;AACtB,CAAC;AAED,OAAO,MAAMoB,oBAAoB,GAAIH,WAAW,IAAK;EACnD,IAAI;IACF,MAAMa,YAAY,GAAGnC,UAAU,CAACsB,WAAW,CAAC;IAC5C,OAAOa,YAAY,CAACC,GAAG,GAAGC,IAAI,CAACC,GAAG,CAAC,CAAC,GAAG,IAAI;EAC7C,CAAC,CAAC,OAAOC,GAAG,EAAE;IACZ,OAAO,IAAI,CAAC,CAAC;EACf;AACF,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}